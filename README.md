# vue-list

> A solution to build an infinite load more list component.

[在线DEMO](https://hejx.herokuapp.com/vue-list/)

## 序

众所周知，列表滚动加载这种需求很常见，特别是在移动webapp上。Github上各款移动端ui框架都会包含滚动加载功能的组件，但它们往往只提供很基础的功能，例如简单地监听滚动条并在满足条件的时候触发回调，然后通过某些方法把新的元素加入到页面末尾。这样的确可以解决分页加载数据的问题，但是在一个数据量比较大的情况下，页面元素会增加得很快，这时就会导致性能问题，想象一下，如果一个移动端页面上有1万条数据需要显示在页面的时候，是多么恐怖的事情。

然后，这个repo并不是要提供一个完整的滚动加载组件，而是，提供一种在数据量大的情况下，对列表的滚动加载进行优化的解决方案。

ps: 我相信有不少人知道方法，但也应该有不少人还不了解。


## 思考

首先，为何要对数据量大的列表页进行滚动加载优化呢？主要的一个原因就是页面上元素太多了，滚动的时候会有卡顿的问题，移动端上更为明显。

那既然元素太多导致的问题，解决方法不就很明显了吗？没错，就是 **减少页面元素**

OK，假设现在列表的元素结构是酱紫的：

```html
<ul class="list">
  <li class="item">...</li>
  ...
</ul>
```

那么现在有几个问题要解决的：

* 什么时候开始删除元素，什么时候把删了的元素显示回来
* 被删了的元素会导致高度减少，怎样保持总高度不变
* 如何确保列表元素显示在应该出现的位置
* 什么时候开始加载新数据


## 先来一张图

<img src="https://github.com/Alex-fun/vue-list/blob/master/src/assets/view.png?raw=true" width="250" alt="view"/>

那么在开始之前，必须要先说明白上图的3色块的作用。

首先，这里有一个前提，就是**列表的每个item的高度要一致**，这主要是为了方便计算。

* screen: 我们可以理解为屏幕或者是显示列表的容器，我们主要是需要通过它来计算出当前screen里可以显示多少个item
* above: 当前显示列表的上方，一般高度为screen高度的2倍
* below: 当前屏幕下方

默认情况下，它们所占的比例为1:2:1，那么这里要区分这3个区域，主要是为了列表在滚动的时候能够确保列表中有内容显示。

## 制作

基于上面提出的3个问题，我们把列表的元素结构改一下：

```html
<div class="content">
  <ul class="list">
    <li class="item">...</li>
    ...
  </ul>
</div>
```

为啥要改成这样呢？首先，我们是要删除元素的，为了保持总高度不变，我们要把ul这个元素的高度设为所有item加起来的总高度，那此时列表的screen就是类名为content的div元素了，也就是说整个ul列表是在叫content的这个div里滚动。

那么这里还是那个问题，怎样保持ul的总高度不变，其实方法有很多，

* 1: 对ul设置总高度，然后显示item进行相对定位


既然是滚动加载，那肯定还是得监听滚动条。

## 保持总高度

## 加载新数据

## Build Setup

``` bash
# install dependencies
npm install

# serve with hot reload at localhost:8080
npm run dev
```
